<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>lijinhao's blog | lijinhao's blog</title><meta name="author" content="lijinhao"><meta name="copyright" content="lijinhao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NoSQLæ•°æ®åº“æ¦‚è¿°NoSQL(NoSQL&#x3D;Not Only SQL)ï¼Œæ„å³â€ä¸ä»…ä»…æ˜¯SQLâ€ï¼Œæ³›æŒ‡ éå…³ç³»å‹çš„æ•°æ®åº“ ï¼šNoSQLä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„ key-value æ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚  ä¸éµå¾ªSQLæ ‡å‡† ä¸æ”¯æŒACIDï¼ˆä½†æ”¯æŒäº‹åŠ¡ï¼‰ è¿œè¶…äºSQLçš„æ€§èƒ½  é€‚ç”¨åœºæ™¯ å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™ æµ·é‡æ•°æ®çš„è¯»å†™ å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„  ä¸é€‚ç”¨åœºæ™¯ éœ€è¦äº‹åŠ¡æ”¯æŒ"><meta property="og:type" content="article"><meta property="og:title" content="lijinhao&#39;s blog"><meta property="og:url" content="https://lijinhao.site/2022/05/25/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93/index.html"><meta property="og:site_name" content="lijinhao&#39;s blog"><meta property="og:description" content="NoSQLæ•°æ®åº“æ¦‚è¿°NoSQL(NoSQL&#x3D;Not Only SQL)ï¼Œæ„å³â€ä¸ä»…ä»…æ˜¯SQLâ€ï¼Œæ³›æŒ‡ éå…³ç³»å‹çš„æ•°æ®åº“ ï¼šNoSQLä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„ key-value æ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚  ä¸éµå¾ªSQLæ ‡å‡† ä¸æ”¯æŒACIDï¼ˆä½†æ”¯æŒäº‹åŠ¡ï¼‰ è¿œè¶…äºSQLçš„æ€§èƒ½  é€‚ç”¨åœºæ™¯ å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™ æµ·é‡æ•°æ®çš„è¯»å†™ å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„  ä¸é€‚ç”¨åœºæ™¯ éœ€è¦äº‹åŠ¡æ”¯æŒ"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><meta property="article:published_time" content="2022-05-25T03:08:12.392Z"><meta property="article:modified_time" content="2022-06-17T08:17:09.504Z"><meta property="article:author" content="lijinhao"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lijinhao.site/2022/05/25/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"Copy successfully",error:"Copy error",noSupport:"The browser does not support"},relativeDate:{homepage:!1,post:!1},runtime:"days",date_suffix:{just:"Just",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"lijinhao's blog",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-06-17 16:17:09"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));GLOBAL_CONFIG_SITE.isHome&&/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom@1.0.0.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/portrait.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">67</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">lijinhao's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">No title</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-05-25T03:08:12.392Z" title="Created 2022-05-25 11:08:12">2022-05-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-17T08:17:09.504Z" title="Updated 2022-06-17 16:17:09">2022-06-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="NoSQLæ•°æ®åº“"><a href="#NoSQLæ•°æ®åº“" class="headerlink" title="NoSQLæ•°æ®åº“"></a>NoSQLæ•°æ®åº“</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>NoSQL(NoSQL=Not Only SQL)ï¼Œæ„å³â€ä¸ä»…ä»…æ˜¯SQLâ€ï¼Œæ³›æŒ‡ <strong>éå…³ç³»å‹çš„æ•°æ®åº“</strong> ï¼šNoSQLä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„ <strong>key-value</strong> æ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚</p><ul><li>ä¸éµå¾ªSQLæ ‡å‡†</li><li>ä¸æ”¯æŒACIDï¼ˆä½†æ”¯æŒäº‹åŠ¡ï¼‰</li><li>è¿œè¶…äºSQLçš„æ€§èƒ½</li></ul><h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><ul><li>å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™</li><li>æµ·é‡æ•°æ®çš„è¯»å†™</li><li>å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„</li></ul><h2 id="ä¸é€‚ç”¨åœºæ™¯"><a href="#ä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="ä¸é€‚ç”¨åœºæ™¯"></a>ä¸é€‚ç”¨åœºæ™¯</h2><ul><li>éœ€è¦äº‹åŠ¡æ”¯æŒ</li><li>åŸºäºsqlçš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ï¼Œå¤„ç†å¤æ‚çš„å…³ç³»ï¼Œéœ€è¦<strong>å³å¸­</strong>æŸ¥è¯¢</li></ul><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><ul><li>å‡ ä¹è¦†ç›–äº†Memcachedçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼›</li><li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ”¯æŒ<strong>æŒä¹…åŒ–</strong>ï¼Œä¸»è¦ç”¨ä½œå¤‡ä»½æ¢å¤ï¼›</li><li>é™¤äº†æ”¯æŒç®€å•çš„key-valueæ¨¡å¼ï¼Œè¿˜æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ï¼Œæ¯”å¦‚<strong>listã€setã€hashã€zset</strong>ç­‰ï¼›</li><li>ä¸€èˆ¬æ˜¯ä½œä¸º<strong>ç¼“å­˜æ•°æ®åº“</strong>è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“ã€‚</li></ul><h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><ul><li>é«˜æ€§èƒ½ã€å¼€æºã€æ¨¡å¼è‡ªç”±(schema free)çš„<strong>æ–‡æ¡£å‹æ•°æ®åº“</strong>ï¼›</li><li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼ŒæŠŠä¸å¸¸ç”¨çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ï¼›</li><li>è™½ç„¶æ˜¯<strong>key-value</strong>æ¨¡å¼ï¼Œä½†æ˜¯å¯¹value(å°¤å…¶æ˜¯<strong>json</strong>)æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½æ”¯æŒäºŒè¿›åˆ¶æ•°æ®åŠå¤§å‹å¯¹è±¡ï¼›</li><li>å¯ä»¥æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹<strong>æ›¿ä»£ RDBMS</strong>ï¼Œæˆä¸ºç‹¬ç«‹çš„æ•°æ®åº“ã€‚æˆ–è€…é…åˆRDBMSï¼Œå­˜å‚¨ç‰¹å®šçš„æ•°æ®ã€‚</li></ul><h1 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h1><p>é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨0å·åº“</p><p>ä½¿ç”¨å‘½ä»¤<code>select&lt;dbid&gt;</code>æ¥åˆ‡æ¢æ•°æ®åº“ã€‚å¦‚ï¼šselect8ç»Ÿä¸€å¯†ç ç®¡ç†ï¼Œæ‰€æœ‰åº“åŒæ ·å¯†ç ã€‚</p><ul><li>dbsizeæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„<code>key</code>çš„æ•°é‡</li><li>flushdbæ¸…ç©ºå½“å‰åº“</li><li>flushaé€šæ€å…¨éƒ¨åº“</li></ul><p>Redisæ˜¯<strong>å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨æŠ€æœ¯</strong>ï¼Œ<strong>å¤šè·¯å¤ç”¨</strong>æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ª<strong>æ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰</strong>çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨<strong>select</strong>å’Œ<strong>poll</strong>å‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± )ã€‚</p><p><strong>ä¸²è¡Œ VS å¤šçº¿ç¨‹ + é”ï¼ˆmemcachedå•çº¿ç¨‹ + å¤šè·¯IOå¤ç”¨Redisï¼‰</strong><br>Redisä¸Memcacheä¸‰ç‚¹ä¸åŒï¼š</p><ol><li>æ”¯æŒå¤šæ•°æ®ç±»å‹ï¼›</li><li>æ”¯æŒæŒä¹…åŒ–ï¼›</li><li>å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨ï¼›</li></ol><p>![image-20220528223603211](/Users/baikal/Library/Application Support/typora-user-images/image-20220528223603211.png)</p><h3 id="keyé”®æ“ä½œ"><a href="#keyé”®æ“ä½œ" class="headerlink" title="keyé”®æ“ä½œ"></a>keyé”®æ“ä½œ</h3><ul><li><code>keys *</code>æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key(åŒ¹é…ï¼škeys *1)</li><li><code>exists key</code>åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</li><li><code>type key</code>æŸ¥çœ‹keyæ˜¯ä»€ä¹ˆç±»å‹</li><li><code>del key</code> åˆ é™¤æŒ‡å®šçš„keyæ•°æ®</li><li><code>unlink key</code>æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤ï¼Œä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‚</li><li><code>expire key 10</code> 10ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œ</li><li><code>ttl key</code>æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ</li><li><code>select</code>å‘½ä»¤åˆ‡æ¢æ•°æ®åº“</li><li><code>dbsize</code>æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡</li></ul><ul><li><p><code>set key value</code> è®¾ç½®å€¼</p></li><li><p><code>append key value</code> è¿½åŠ å€¼</p></li><li><p><code>get value</code> è·å–å€¼</p></li><li><p><code>strlen key</code> è·å–å€¼é•¿åº¦</p></li><li><p><code>setnx &lt;key&gt;&lt;value &gt;</code>åªæœ‰åœ¨keyä¸å­˜åœ¨æ—¶è®¾ç½®keyçš„å€¼</p></li><li><p><code>incr &lt;key&gt;</code> å°†keyä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢1</p></li><li><p><code>decr &lt;key&gt;</code> å°†keyä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1</p></li><li><p><code>incrby &lt;key&gt; step</code> å°†keyä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢åŠ step</p></li></ul><h4 id="incr-æ“ä½œ"><a href="#incr-æ“ä½œ" class="headerlink" title="incr æ“ä½œ"></a>incr æ“ä½œ</h4><ul><li><p>å…·æœ‰åŸå­æ€§</p><ol><li>æ‰€è°“<strong>åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œ</strong>ï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½•<strong>context switch(åˆ‡æ¢åˆ°å¦ä¸ªçº¿ç¨‹)</strong></li><li>åœ¨å•çº¿ç¨‹ä¸­ï¼Œèƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯â€åŸå­æ“ä½œâ€ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´ã€‚</li><li>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œã€‚</li></ol><p>Rediså•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›ŠäºRedisçš„å•çº¿ç¨‹ã€‚</p><p>æ¡ˆä¾‹</p><p>![image-20220529004352611](/Users/baikal/Library/Application Support/typora-user-images/image-20220529004352611.png)</p></li></ul><h2 id="Rediså­—ç¬¦ä¸²ï¼ˆStringï¼‰"><a href="#Rediså­—ç¬¦ä¸²ï¼ˆStringï¼‰" class="headerlink" title="Rediså­—ç¬¦ä¸²ï¼ˆStringï¼‰"></a>Rediså­—ç¬¦ä¸²ï¼ˆStringï¼‰</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><ul><li>Stringæ˜¯Redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œ<strong>ä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalue</strong>ã€‚</li><li>Stringç±»å‹æ˜¯<strong>äºŒè¿›åˆ¶å®‰å…¨</strong>ï¼ˆåªè¦æ•°æ®èƒ½ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå°±èƒ½å­˜å…¥æ•°æ®åº“ï¼‰çš„ã€‚æ„å‘³ç€Redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</li><li>Stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯<strong>512M</strong>ã€‚</li></ul><p><code>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;.....</code><br>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª<code>key-value</code>å¯¹<code>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt;.....</code><br>åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ªvalue</p><p><code>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;....</code><br>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª<code>key-value</code>å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®škeyéƒ½ä¸å­˜åœ¨</p><p><strong>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</strong></p><p><code>getrange &lt;key&gt; &lt;èµ·å§‹ä½ç½®&gt; &lt;ç»“æŸä½ç½®&gt;</code>è·å¾—å€¼çš„èŒƒå›´ï¼Œç±»ä¼¼javaä¸­çš„<code>str.substring(å·¦å¼€ï¼Œå³é—­)</code></p><p><code>setrange &lt;key&gt; &lt;èµ·å§‹ä½ç½®&gt; &lt;value&gt;</code></p><p>ç”¨<code>&lt;value&gt;</code>è¦†å†™<code>&lt;key&gt;</code>æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; set name lucymary</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; getrange name 0 3</span><br><span class="line">&quot;lucy&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt; setrange name 3 abc</span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379[1]&gt; get name</span><br><span class="line">&quot;lucabcry&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure><p><code>setex &lt;key&gt; &lt;è¿‡æœŸæ—¶é—´&gt; &lt;value&gt;</code><br>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’</p><p><code>getset &lt;key&gt;&lt;value&gt;</code><br>ä»¥æ–°æ¢æ—§ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼</p><h3 id="Stringæ•°æ®ç»“æ„"><a href="#Stringæ•°æ®ç»“æ„" class="headerlink" title="Stringæ•°æ®ç»“æ„"></a>Stringæ•°æ®ç»“æ„</h3><p>Stringçš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²(Simple Dynamic Stringï¼Œç¼©å†™SDS)<strong>æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²</strong>ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</p><p>![image-20220530200505815](/Users/baikal/Library/Application Support/typora-user-images/image-20220530200505815.png)</p><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´capacityä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenï¼Œå½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º512Mã€‚</p><h2 id="Redis-List"><a href="#Redis-List" class="headerlink" title="Redis List"></a>Redis List</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><ol><li><p>å•é”®å¤šå€¼</p><p>Redis Listæ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚<br>å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚</p><p>![image-20220530202203342](/Users/baikal/Library/Application Support/typora-user-images/image-20220530202203342.png)</p></li></ol><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>lpush/rpush &lt;key&gt; &lt;value1&gt; &lt;value2&gt; &lt;value3&gt;...</code>ä»å·¦è¾¹/å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; lpush k1 v1 k2 v2 k3 v3</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379[1]&gt; lrange k1 0 -1</span><br><span class="line">1) &quot;v3&quot;</span><br><span class="line">2) &quot;k3&quot;</span><br><span class="line">3) &quot;v2&quot;</span><br><span class="line">4) &quot;k2&quot;</span><br><span class="line">5) &quot;v1&quot;</span><br></pre></td></tr></table></figure></li><li><p><code>lpop/rpop &lt;key&gt;</code> ä»å·¦è¾¹/å³è¾¹åå‡ºä¸€ä¸ªå€¼ã€‚<strong>å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡</strong></p></li><li><p><code>rpoplpush &lt;key1&gt; &lt;key2&gt;</code> ä»<code>&lt;key1&gt;</code>åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°<code>&lt;key2&gt;</code>åˆ—è¡¨å·¦è¾¹ã€‚</p></li><li><p><code>lrange &lt;key&gt; &lt;start&gt; &lt;stop&gt;</code>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ ï¼ˆä»å·¦åˆ°å³)</p></li><li><p><code>lrange mylist 0 -1</code></p><p>0ï¼šå·¦è¾¹ç¬¬ä¸€ä¸ªï¼Œ-1ï¼šå³è¾¹ç¬¬ä¸€ä¸ªï¼Œï¼ˆ0-1è¡¨ç¤ºè·å–æ‰€æœ‰)</p></li><li><p><code>lindex &lt;key&gt; &lt;index&gt;</code>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ ï¼ˆä»å·¦åˆ°å³ï¼‰</p></li><li><p><code>llen&lt;key&gt;</code>è·å¾—åˆ—è¡¨é•¿åº¦</p></li><li><p><code>linsert &lt;key&gt; ã€beforeï½œafterã€‘ &lt;value&gt; &lt;newvalue&gt;</code>åœ¨<code>&lt;value&gt;</code>çš„ã€åé¢ï½œå‰é¢ã€‘æ’å…¥<code>&lt;newvalue&gt;</code>æ’å…¥å€¼</p></li><li><p><code>lrem &lt;key&gt; &lt;n&gt; &lt;value&gt;</code>ä»å·¦è¾¹åˆ é™¤nä¸ª<code>value</code>(ä»å·¦åˆ°å³ï¼‰</p></li><li><p><code>lset &lt;key&gt; &lt;index&gt; &lt;value&gt;</code>å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</p></li></ol><h3 id="List-æ•°æ®ç»“æ„"><a href="#List-æ•°æ®ç»“æ„" class="headerlink" title="List æ•°æ®ç»“æ„"></a>List æ•°æ®ç»“æ„</h3><p>Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨<code>quickList</code></p><p>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯<code>ziplist</code>ï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨</p><p>å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚</p><p>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¤šä¸ª<code>ziplist</code>ä½œä¸ºèŠ‚ç‚¹nodeï¼Œ è¢«è¿æ¥ğŸ”—æˆä¸ºquicklistã€‚</p><p>![image-20220530205306043](/Users/baikal/Library/Application Support/typora-user-images/image-20220530205306043.png)</p><p>å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯intç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ<code>prev</code>å’Œ<code>next</code>ã€‚</p><p>Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis setå¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºsetæ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªsté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„</p><p>Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„Hashè¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„**å¤æ‚åº¦éƒ½æ˜¯0(1)**ã€‚</p><p>ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯O(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜</p><h3 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>sadd &lt;key&gt; &lt;value1&gt; &lt;value2&gt;...</code><br>å°†ä¸€ä¸ªæˆ–å¤šä¸ªmemberå…ƒç´ åŠ å…¥åˆ°é›†åˆkeyä¸­ï¼Œå·²ç»å­˜åœ¨çš„memberå…ƒç´ å°†è¢«å¿½ç•¥</p></li><li><p><code>smembers &lt;key&gt;</code>å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; sadd k1 v1 v2 v3</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379[1]&gt; SMEMBERS k1</span><br><span class="line">1) &quot;v3&quot;</span><br><span class="line">2) &quot;v1&quot;</span><br><span class="line">3) &quot;v2&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>sismember &lt;key&gt; &lt;value&gt;</code>åˆ¤æ–­é›†åˆ<code>&lt;key&gt;</code>æ˜¯å¦ä¸ºå«æœ‰è¯¥<code>&lt;value&gt;</code>å€¼ï¼Œæœ‰åˆ™ä¸º1ï¼Œæ²¡æœ‰åˆ™ä¸º0</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; SISMEMBER k1 v1</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure></li><li><p><code>scard &lt;key&gt;</code>è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°</p></li><li><p><code>srem &lt;key&gt; &lt;value1&gt; &lt;value2&gt; ...</code>åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ </p></li><li><p><code>spop &lt;key&gt;</code> <strong>éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼</strong></p></li><li><p><code>srandmember &lt;key&gt; &lt;n&gt;</code>éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ï¼Œä¸ä¼šä»é›†åˆä¸­åˆ é™¤</p></li><li><p><code>smove &lt;source&gt; &lt;destination&gt; value</code> æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ</p></li><li><p><code>sinter &lt;key1&gt; &lt;key2&gt;</code>è¿”å›ä¸¤ä¸ªé›†åˆçš„<strong>äº¤é›†</strong>å…ƒç´ </p></li><li><p><code>sunion&lt;key1&gt; &lt;key2&gt;</code>è¿”å›ä¸¤ä¸ªé›†åˆçš„<strong>å¹¶é›†</strong>å…ƒç´ </p></li><li><p><code>sdif &lt;key1&gt; &lt;key2&gt;</code> è¿”å›ä¸¤ä¸ªé›†åˆçš„<strong>å·®é›†</strong>å…ƒç´ (key1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„)</p></li></ol><h3 id="Setæ•°æ®ç»“æ„"><a href="#Setæ•°æ®ç»“æ„" class="headerlink" title="Setæ•°æ®ç»“æ„"></a>Setæ•°æ®ç»“æ„</h3><p>Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚</p><p>è·ŸJavaçš„HashSetç±»ä¼¼ï¼ŒJavaä¸­HashSetçš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚<br>Redisçš„Setç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨Hashç»“æ„ï¼Œæ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p><h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><h3 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis Hashæ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆ</p><p>Redis Hashæ˜¯ä¸€ä¸ªStringç±»å‹çš„<strong>field</strong>å’Œ<strong>value</strong>çš„æ˜ å°„è¡¨ï¼ŒHashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡</p><p>ç±»ä¼¼Javaé‡Œé¢çš„<code>Map&lt;String, Object&gt;</code></p><p>![image-20220531140159033](/Users/baikal/Library/Application Support/typora-user-images/image-20220531140159033.png)</p><p>ç”¨æˆ·IDä¸ºæŸ¥æ‰¾çš„keyï¼Œå­˜å‚¨çš„valueç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯ï¼Œå¦‚æœç”¨æ™®é€šçš„key/valueç»“æ„æ¥å­˜å‚¨</p><p>ä¸»è¦æœ‰ä»¥ä¸‹2ç§å­˜å‚¨æ–¹å¼ï¼š</p><p>![image-20220531141342119](/Users/baikal/Library/Application Support/typora-user-images/image-20220531141342119.png)</p><p>Hashæ³•é€šè¿‡**key(ç”¨æˆ·ID)+field(å±æ€§æ ‡ç­¾)**å°±å¯ä»¥æ“ä½œå¯¹åº”å±æ€§æ•°æ®ï¼Œæ—¢ä¸éœ€è¦é‡å¤å­˜å‚¨æ•°æ®ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥åºåˆ—åŒ–å’Œå¹¶å‘ä¿®æ”¹æ§åˆ¶çš„é—®é¢˜</p><h3 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>hset &lt;key&gt; &lt;field&gt; &lt;value&gt;</code>ç»™ <code>&lt;key&gt;</code>é›†åˆä¸­çš„<code>&lt;field&gt;</code>é”®èµ‹å€¼<code>&lt;value&gt;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; hset user:1001 id 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; hset user:1001 name zhangsan</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; hget user:1001 id</span><br><span class="line">&quot;1&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt; hget user:1001 name</span><br><span class="line">&quot;zhangsan&quot;</span><br></pre></td></tr></table></figure></li><li><p><code>hget &lt;keyl&gt; &lt;field&gt;</code>ä»<code>&lt;keyl&gt;</code>é›†åˆ<code>&lt;field&gt;</code>å–å‡º<code>value</code></p></li><li><p><code>hmset &lt;keyl&gt; &lt;fieldl&gt; &lt;value&gt; &lt;field2&gt; &lt;value2&gt; ...</code>æ‰¹é‡è®¾ç½®hashçš„å€¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; hmset user:1002 id 2 name lisi age 30</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; hget user:1002 id</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure></li><li><p><code>hexists&lt;keyl&gt; &lt;field&gt;</code> æŸ¥çœ‹å“ˆå¸Œè¡¨keyä¸­ï¼Œç»™å®šåŸŸfieldæ˜¯å¦å­˜åœ¨</p></li><li><p><code>hkeys &lt;key&gt;</code>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</p></li><li><p><code>hvals&lt;key&gt;</code>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</p></li><li><p><code>hinerby &lt;key&gt; &lt;field&gt; &lt;increment&gt;</code> ä¸ºå“ˆå¸Œè¡¨<code>key</code>ä¸­çš„åŸŸ<code>field</code>çš„å€¼åŠ ä¸Šå¢é‡1 -1</p></li><li><p><code>hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt;</code>å°†å“ˆå¸Œè¡¨<code>key</code>ä¸­çš„åŸŸ<code>field</code>çš„å€¼è®¾ç½®ä¸º<code>value</code>ï¼Œå½“ä¸”ä»…å½“åŸŸ<code>field</code>ä¸å­˜åœ¨</p></li></ol><h3 id="Hashæ•°æ®ç»“æ„"><a href="#Hashæ•°æ®ç»“æ„" class="headerlink" title="Hashæ•°æ®ç»“æ„"></a>Hashæ•°æ®ç»“æ„</h3><p>Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplist(å‹ç¼©åˆ—è¡¨)ï¼Œhashtable(å“ˆå¸Œè¡¨)ã€‚</p><p>å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtable</p><h2 id="æœ‰åºé›†åˆZsetï¼ˆsorted-setï¼‰"><a href="#æœ‰åºé›†åˆZsetï¼ˆsorted-setï¼‰" class="headerlink" title="æœ‰åºé›†åˆZsetï¼ˆsorted setï¼‰"></a>æœ‰åºé›†åˆZsetï¼ˆsorted setï¼‰</h2><h3 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redisæœ‰åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚<strong>ä¸åŒä¹‹å¤„</strong>æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª**è¯„åˆ†(score)**ï¼Œè¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚</p><p><strong>é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤çš„</strong>ã€‚</p><p>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†(score)æˆ–è€…æ¬¡åº(position)æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</p><p>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p><h3 id="Zsetæ•°æ®ç»“æ„"><a href="#Zsetæ•°æ®ç»“æ„" class="headerlink" title="Zsetæ•°æ®ç»“æ„"></a>Zsetæ•°æ®ç»“æ„</h3><p>**SortedSet(zset)**æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„</p><p>ä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„<code>Map&lt;String, Double&gt;</code>ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡score</p><p>å¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äº<code>TreeSet</code>ï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨</p><h3 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><strong>ZADD key score member [[score member] [score member] â€¦]</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; zadd page_rank 10 google.com</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; zadd page_rank 9 baidu.com 8 bing.com</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379[1]&gt; zrange page_rank 0 -1 withscores</span><br><span class="line">1) &quot;bing.com&quot;</span><br><span class="line">2) &quot;8&quot;</span><br><span class="line">3) &quot;baidu.com&quot;</span><br><span class="line">4) &quot;9&quot;</span><br><span class="line">5) &quot;google.com&quot;</span><br><span class="line">6) &quot;10&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ZCARD key</strong> è¿”å›æœ‰åºé›† <code>key</code> çš„åŸºæ•°ï¼Œå½“ key å­˜åœ¨ä¸”æ˜¯æœ‰åºé›†ç±»å‹æ—¶ï¼Œè¿”å›æœ‰åºé›†çš„åŸºæ•°ã€‚å½“ key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å› 0 ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; zadd salary 2000 tom</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; zcard salary</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; zadd salary 5000 jack</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; zcard salary</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure></li><li><p><strong>ZCOUNT key min max</strong></p><p>è¿”å›æœ‰åºé›† <code>key</code> ä¸­ï¼Œ <code>score</code> å€¼åœ¨ <code>min</code> å’Œ <code>max</code> ä¹‹é—´(é»˜è®¤åŒ…æ‹¬ <code>score</code> å€¼ç­‰äº <code>min</code> æˆ– <code>max</code> )çš„æˆå‘˜çš„æ•°é‡ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; zcount salary 2000 5000</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure></li><li><p><strong>ZINCRBY key increment member</strong></p></li></ol><p>â€‹ ä¸ºæœ‰åºé›† <code>key</code> çš„æˆå‘˜ <code>member</code> çš„ <code>score</code> å€¼åŠ ä¸Šå¢é‡ <code>increment</code></p><p>â€‹ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªè´Ÿæ•°å€¼ <code>increment</code> ï¼Œè®© <code>score</code> å‡å»ç›¸åº”çš„å€¼ï¼Œæ¯”å¦‚ <code>ZINCRBY key -5 member</code> ï¼Œå°±æ˜¯è®© <code>member</code> çš„ <code>score</code> å€¼å‡å» <code>5</code></p><p>â€‹ å½“ <code>key</code> ä¸å­˜åœ¨ï¼Œæˆ– <code>member</code> ä¸æ˜¯ <code>key</code> çš„æˆå‘˜æ—¶ï¼Œ <code>ZINCRBY key increment member</code> ç­‰åŒäº <code>ZADD key increment member</code></p><p>â€‹ å½“ <code>key</code> ä¸æ˜¯æœ‰åºé›†ç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯</p><ol start="5"><li><p><strong>ZRANGE key start stop [WITHSCORES]</strong></p><p>è¿”å›æœ‰åºé›† <code>key</code> ä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚</p><p>å…¶ä¸­æˆå‘˜çš„ä½ç½®æŒ‰ <code>score</code> å€¼é€’å¢(ä»å°åˆ°å¤§)æ¥æ’åºã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; zrange salary 0 -1 withscores   # æ˜¾ç¤ºæ•´ä¸ªæœ‰åºé›†æˆå‘˜</span><br><span class="line">1) &quot;tom&quot;</span><br><span class="line">2) &quot;2000&quot;</span><br><span class="line">3) &quot;jack&quot;</span><br><span class="line">4) &quot;5000&quot;</span><br></pre></td></tr></table></figure></li></ol><p>zsetåº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p><ol><li>Hashï¼šä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚</li><li>è·³è·ƒè¡¨ï¼Œè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</li></ol><p>â€‹ æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Rdisé‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚</p><ul><li><p>æœ‰åºé“¾è¡¨</p><p>![image-20220531201752494](/Users/baikal/Library/Application Support/typora-user-images/image-20220531201752494.png)</p><p>è¦æŸ¥æ‰¾å€¼ä¸º51çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ã€‚å…±éœ€è¦6æ¬¡æ¯”è¾ƒã€‚</p></li><li><p>è·³è·ƒè¡¨</p><p>![image-20220531201828720](/Users/baikal/Library/Application Support/typora-user-images/image-20220531201828720.png)</p><p>ä»ç¬¬2å±‚å¼€å§‹ï¼Œ1èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚21èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯NULLäº†ï¼Œæ‰€ä»¥ä»21èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬1å±‚<br>åœ¨ç¬¬1å±‚ï¼Œ41èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä»41å‘ä¸‹<br>åœ¨ç¬¬0å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾4æ¬¡ã€‚</p></li></ul><p>æ¡ˆä¾‹ï¼šåˆ©ç”¨zsetå®ç°æ–‡ç« è®¿é—®é‡æ’è¡Œæ¦œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; zadd topn 1000 java 500 C++ 1200 Python 400 Golang</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379[1]&gt; ZREVRANGE topn 0 9 withscores</span><br><span class="line">1) &quot;Python&quot;</span><br><span class="line">2) &quot;1200&quot;</span><br><span class="line">3) &quot;java&quot;</span><br><span class="line">4) &quot;1000&quot;</span><br><span class="line">5) &quot;C++&quot;</span><br><span class="line">6) &quot;500&quot;</span><br><span class="line">7) &quot;Golang&quot;</span><br><span class="line">8) &quot;400&quot;</span><br></pre></td></tr></table></figure><h2 id="BitMaps"><a href="#BitMaps" class="headerlink" title="BitMaps"></a>BitMaps</h2><p>ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶ï¼ˆä½ï¼‰ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œä¾‹å¦‚â€abcâ€å­—ç¬¦ä¸²æ˜¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨éƒ½æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œâ€œabcâ€åˆ†åˆ«å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯97ã€98ã€99ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯01100001ã€01100010å’Œ01100011ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>![image-20220531220847669](/Users/baikal/Library/Application Support/typora-user-images/image-20220531220847669.png)</p><p>åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€æ•°æ®ç±»å‹â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š</p><ol><li>Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²(key-value)ï¼Œä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</li><li>Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œæ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡ã€‚</li></ol><p>![image-20220531221011076](/Users/baikal/Library/Application Support/typora-user-images/image-20220531221011076.png)</p><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><ol><li><p><strong>SETBIT key offset value</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; setbit users:20210101 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt; setbit users:20210101 6 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt; setbit users:20210101 11 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt; setbit users:20210101 15 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt; setbit users:20210101 19 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure></li></ol><p>â€‹ å®Œæˆä¸Šè¿°æŒ‡ä»¤åï¼ŒBitmapsåˆå§‹åŒ–çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>![image-20220531221733102](/Users/baikal/Library/Application Support/typora-user-images/image-20220531221733102.png)</p><p>â€‹ å¯ç”¨äºè¡¨ç¤º20ä¸ªç”¨æˆ·æ˜¯å¦å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ã€‚</p><p>â€‹ å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰å¼€å¤´ï¼Œç›´æ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡å»è¿™ä¸ªæŒ‡å®šæ•°å­— ã€‚</p><p>â€‹ åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œå‡å¦‚åç§»é‡éå¸¸ å¤§ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼š æ¯”è¾ƒæ…¢ï¼Œå¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚</p><p>â€‹ setrangeè­¦å‘Šâš ï¸</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“ç”Ÿæˆä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²æ—¶ï¼ŒRedis éœ€è¦åˆ†é…å†…å­˜ç©ºé—´ï¼Œè¯¥æ“ä½œæœ‰æ—¶å€™å¯èƒ½ä¼šé€ æˆæœåŠ¡å™¨é˜»å¡(block)ã€‚åœ¨2010å¹´çš„Macbook Proä¸Šï¼Œè®¾ç½®åç§»é‡ä¸º 536870911(512MB å†…å­˜åˆ†é…)ï¼Œè€—è´¹çº¦ 300 æ¯«ç§’ï¼Œ è®¾ç½®åç§»é‡ä¸º 134217728(128MB å†…å­˜åˆ†é…)ï¼Œè€—è´¹çº¦ 80 æ¯«ç§’ï¼Œè®¾ç½®åç§»é‡ 33554432(32MB å†…å­˜åˆ†é…)ï¼Œè€—è´¹çº¦ 30 æ¯«ç§’ï¼Œè®¾ç½®åç§»é‡ä¸º 8388608(8MB å†…å­˜åˆ†é…)ï¼Œè€—è´¹çº¦ 8 æ¯«ç§’ã€‚ æ³¨æ„è‹¥é¦–æ¬¡å†…å­˜åˆ†é…æˆåŠŸä¹‹åï¼Œå†å¯¹åŒä¸€ä¸ª key è°ƒç”¨ SETRANGE æ“ä½œï¼Œæ— é¡»å†é‡æ–°å†…å­˜ã€‚</span><br></pre></td></tr></table></figure><ol start="2"><li><p><strong>GETBIT key offset</strong></p><p>å¯¹ <code>key</code> æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</p><p>å½“ <code>offset</code> æ¯”å­—ç¬¦ä¸²å€¼çš„é•¿åº¦å¤§ï¼Œæˆ–è€… <code>key</code> ä¸å­˜åœ¨æ—¶ï¼Œè¿”å› <code>0</code> ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; GETBIT users:20210101 15</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; GETBIT users:20210101 18</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>BITCOUNT key [start] [end]</strong></p><p>è®¡ç®—ç»™å®šå­—ç¬¦ä¸²ä¸­ï¼Œè¢«è®¾ç½®ä¸º <code>1</code> çš„æ¯”ç‰¹ä½çš„æ•°é‡</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ <code>start</code> æˆ– <code>end</code> å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; BITCOUNT users:20210101</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>BITOP operation destkey key [key â€¦]</strong></p><p>å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸² <code>key</code> è¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> ä¸Šã€‚</p><p><code>operation</code> å¯ä»¥æ˜¯ <code>AND</code> ã€ <code>OR</code> ã€ <code>NOT</code> ã€ <code>XOR</code> è¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§ï¼š</p><ul><li><p><code>BITOP AND destkey key [key ...]</code> ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚é€»è¾‘å¹¶ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> ã€‚</p></li><li><p><code>BITOP OR destkey key [key ...]</code> ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚é€»è¾‘æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> ã€‚</p></li><li><p><code>BITOP XOR destkey key [key ...]</code> ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> æ±‚é€»è¾‘å¼‚æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> ã€‚</p></li><li><p><code>BITOP NOT destkey key</code> ï¼Œå¯¹ç»™å®š <code>key</code> æ±‚é€»è¾‘éï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° <code>destkey</code> ã€‚</p></li></ul><p>é™¤äº† <code>NOT</code> æ“ä½œä¹‹å¤–ï¼Œå…¶ä»–æ“ä½œéƒ½å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ª <code>key</code> ä½œä¸ºè¾“å…¥ã€‚</p></li></ol><p>è®¡ç®—ä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼ˆå¦‚æœˆæ´»è·ƒï¼‰ï¼Œå¯ä»¥ä½¿ç”¨oræ±‚å¹¶é›†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; BITOP or unique:users:or:20210101 unique:users:20210103 unique:users:20210104</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; BITOP and unique:users:and:20210101 unique:users:20210103 unique:users:20210104</span><br></pre></td></tr></table></figure><p>![image-20220531224435126](/Users/baikal/Library/Application Support/typora-user-images/image-20220531224435126.png)</p><p>![image-20220531224608493](/Users/baikal/Library/Application Support/typora-user-images/image-20220531224608493.png)</p><p>â€‹ å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„ã€‚</p><p>![image-20220531224649404](/Users/baikal/Library/Application Support/typora-user-images/image-20220531224649404.png)</p><p>â€‹ ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚</p><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><p>â€‹ åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PVï¼ˆPageViewé¡µé¢è®¿é—®é‡ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚ä½†åƒUVï¼ˆUniqueVisitorç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚</p><p>è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š</p><ol><li><p>æ•°æ®å­˜å‚¨åœ¨MySQLè¡¨ä¸­ï¼Œä½¿ç”¨distinct countè®¡ç®—ä¸é‡å¤ä¸ªæ•°ã€‚</p></li><li><p>ä½¿ç”¨Redisæä¾›çš„hashã€setã€bitmapsç­‰æ•°æ®ç»“æ„æ¥å¤„ç†ã€‚</p></li></ol><p>â€‹ ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼ŸRedisæ¨å‡ºäº†<code>HyperLogLog</code>ã€‚</p><p>â€‹ Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼šåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p><p>â€‹ åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ <code>12 KB</code> å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ <code>2^64</code>ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><p>â€‹ ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä»€ä¹ˆæ˜¯åŸºæ•°?</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚æ•°æ®é›† &#123;1, 3, 5, 7, 5, 7, 8&#125;ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º &#123;1, 3, 5 ,7, 8&#125;ï¼ŒåŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚</span><br></pre></td></tr></table></figure><h2 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a>Geospatial</h2><p>â€‹ Redis 3.2 ä¸­å¢åŠ äº†å¯¹GEOç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„2ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redisåŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦Hashç­‰å¸¸è§æ“ä½œã€‚</p><h1 id="å‘å¸ƒä¸è®¢é˜…"><a href="#å‘å¸ƒä¸è®¢é˜…" class="headerlink" title="å‘å¸ƒä¸è®¢é˜…"></a>å‘å¸ƒä¸è®¢é˜…</h1><h2 id="ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…"><a href="#ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…"></a>ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…</h2><p>Rediså‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>Rediså®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p><p><strong>SUBSCRIBE</strong>ã€<strong>UNSUBSCRIBE</strong> å’Œ <strong>PUBLISH</strong>ä¸‰ä¸ªå‘½ä»¤å®ç°äº†å‘å¸ƒä¸è®¢é˜…ä¿¡æ¯æ³›å‹ï¼ˆPublish/Subscribe messaging paradigmï¼‰</p><p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œå‘é€è€…ï¼ˆå‘é€ä¿¡æ¯çš„å®¢æˆ·ç«¯ï¼‰ä¸æ˜¯å°†ä¿¡æ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„æ¥æ”¶è€…ï¼ˆæ¥æ”¶ä¿¡æ¯çš„å®¢æˆ·ç«¯ï¼‰ï¼Œ è€Œæ˜¯å°†ä¿¡æ¯å‘é€ç»™é¢‘é“ï¼ˆchannelï¼‰ï¼Œ ç„¶åç”±é¢‘é“å°†ä¿¡æ¯è½¬å‘ç»™æ‰€æœ‰å¯¹è¿™ä¸ªé¢‘é“æ„Ÿå…´è¶£çš„è®¢é˜…è€…</p><p>å‘é€è€…æ— é¡»çŸ¥é“ä»»ä½•å…³äºè®¢é˜…è€…çš„ä¿¡æ¯ï¼Œ è€Œè®¢é˜…è€…ä¹Ÿæ— é¡»çŸ¥é“æ˜¯é‚£ä¸ªå®¢æˆ·ç«¯ç»™å®ƒå‘é€ä¿¡æ¯ï¼Œ å®ƒåªè¦å…³æ³¨è‡ªå·±æ„Ÿå…´è¶£çš„é¢‘é“å³å¯</p><p>å¯¹å‘å¸ƒè€…å’Œè®¢é˜…è€…è¿›è¡Œè§£æ„ï¼ˆdecouplingï¼‰ï¼Œ å¯ä»¥æå¤§åœ°æé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼ˆscalabilityï¼‰ï¼Œ å¹¶å¾—åˆ°ä¸€ä¸ªæ›´åŠ¨æ€çš„ç½‘ç»œæ‹“æ‰‘ï¼ˆnetwork topologyï¼‰</p><p>æ¯”å¦‚è¯´ï¼Œ è¦è®¢é˜…é¢‘é“ <code>foo</code> å’Œ <code>bar</code> ï¼Œ å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨é¢‘é“åå­—ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ <a target="_blank" rel="noopener" href="http://doc.redisfans.com/pub_sub/subscribe.html#subscribe"><em>SUBSCRIBE</em></a> å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE foo bar</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;foo&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;bar&quot;</span><br><span class="line">3) (integer) 2</span><br></pre></td></tr></table></figure><p>![image-20220531213405135](/Users/baikal/Library/Application Support/typora-user-images/image-20220531213405135.png)</p><h2 id="è®¢é˜…æ¨¡å¼"><a href="#è®¢é˜…æ¨¡å¼" class="headerlink" title="è®¢é˜…æ¨¡å¼"></a>è®¢é˜…æ¨¡å¼</h2><p>Redis çš„å‘å¸ƒä¸è®¢é˜…å®ç°æ”¯æŒæ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰ï¼š å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä¸€ä¸ªå¸¦ <code>*</code> å·çš„æ¨¡å¼ï¼Œ å¦‚æœæŸä¸ª/æŸäº›é¢‘é“çš„åå­—å’Œè¿™ä¸ªæ¨¡å¼åŒ¹é…ï¼Œ é‚£ä¹ˆå½“æœ‰ä¿¡æ¯å‘é€ç»™è¿™ä¸ª/è¿™äº›é¢‘é“çš„æ—¶å€™ï¼Œ å®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°è¿™ä¸ª/è¿™äº›é¢‘é“çš„ä¿¡æ¯ã€‚</p><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> PSUBSCRIBE news.*</span></span><br></pre></td></tr></table></figure><p>çš„å®¢æˆ·ç«¯å°†æ”¶åˆ°æ¥è‡ª <code>news.art.figurative</code> ã€ <code>news.music.jazz</code> ç­‰é¢‘é“çš„ä¿¡æ¯ã€‚</p><p>å®¢æˆ·ç«¯è®¢é˜…çš„æ¨¡å¼é‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ª glob é£æ ¼çš„é€šé…ç¬¦ï¼Œ æ¯”å¦‚ <code>*</code> ã€ <code>?</code> å’Œ <code>[...]</code> ï¼Œ ç­‰ç­‰ã€‚</p><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> PUNSUBSCRIBE news.*</span></span><br></pre></td></tr></table></figure><p>å°†é€€è®¢ <code>news.*</code> æ¨¡å¼ï¼Œ å…¶ä»–å·²è®¢é˜…çš„æ¨¡å¼ä¸ä¼šè¢«å½±å“</p><h1 id="ä¹è§‚é”å’Œæ‚²è§‚é”"><a href="#ä¹è§‚é”å’Œæ‚²è§‚é”" class="headerlink" title="ä¹è§‚é”å’Œæ‚²è§‚é”"></a>ä¹è§‚é”å’Œæ‚²è§‚é”</h1><h2 id="Multiã€Execã€discard"><a href="#Multiã€Execã€discard" class="headerlink" title="Multiã€Execã€discard"></a>Multiã€Execã€discard</h2><img src="/Users/baikal/Library/Application Support/typora-user-images/image-20220606231208493.png" alt="image-20220606231208493" style="zoom:50%"><p>ä»è¾“å…¥Mutå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚ ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿã€‚</p><img src="/Users/baikal/Library/Application Support/typora-user-images/image-20220606225411344.png" alt="image-20220606225411344" style="zoom:33%"><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>![image-20220606225648298](/Users/baikal/Library/Application Support/typora-user-images/image-20220606225648298.png)</p><p>æ‚²è§‚é”(Pessimistic Lock)ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚<strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>![image-20220606225711761](/Users/baikal/Library/Application Support/typora-user-images/image-20220606225711761.png)</p><p>ä¹è§‚é”(Optimistic Lock)ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<strong>ç‰ˆæœ¬å·</strong>ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äº<strong>å¤šè¯»</strong>çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥<strong>æé«˜ååé‡</strong>ã€‚Rediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚</p><h2 id="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#Redisäº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"></a>Redisäº‹åŠ¡ä¸‰ç‰¹æ€§</h2><ol><li>å•ç‹¬çš„éš”ç¦»æ“ä½œ<br>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li><li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ<br>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</li><li>ä¸ä¿è¯åŸå­æ€§<br>äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li></ol></article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/05/10/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/portrait.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">lijinhao</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">67</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/leekinghou"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/leekinghou" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lijinhao716@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">é†‰åä¸çŸ¥å¤©åœ¨æ°´ï¼Œæ»¡èˆ¹æ¸…æ¢¦å‹æ˜Ÿæ²³âœ¨<div class="twopeople"><div class="twopeople"><div class="container" style="height:200px"><canvas class="illo" width="800" height="800" style="max-width:200px;max-height:200px;touch-action:none;width:640px;height:640px"></canvas></div><script src="https://cdn.guole.fun/js/twopeople1.js"></script><script src="https://cdn.guole.fun/js/zdog.dist.js"></script><script id="rendered-js" src="https://cdn.guole.fun/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">NoSQLæ•°æ®åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.</span> <span class="toc-text">é€‚ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.</span> <span class="toc-text">ä¸é€‚ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-number">1.4.</span> <span class="toc-text">Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB"><span class="toc-number">1.5.</span> <span class="toc-text">MongoDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-1"><span class="toc-number">2.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#key%E9%94%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">2.0.1.</span> <span class="toc-text">keyé”®æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#incr-%E6%93%8D%E4%BD%9C"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">incr æ“ä½œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88String%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">Rediså­—ç¬¦ä¸²ï¼ˆStringï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.2.</span> <span class="toc-text">Stringæ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-List"><span class="toc-number">2.2.</span> <span class="toc-text">Redis List</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.3.</span> <span class="toc-text">List æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set"><span class="toc-number">2.3.</span> <span class="toc-text">Set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.3.3.</span> <span class="toc-text">Setæ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hash"><span class="toc-number">2.4.</span> <span class="toc-text">Hash</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.3.</span> <span class="toc-text">Hashæ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88Zset%EF%BC%88sorted-set%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">æœ‰åºé›†åˆZsetï¼ˆsorted setï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zset%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.5.2.</span> <span class="toc-text">Zsetæ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="toc-number">2.5.3.</span> <span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BitMaps"><span class="toc-number">2.6.</span> <span class="toc-text">BitMaps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.6.1.</span> <span class="toc-text">å¸¸ç”¨æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HyperLogLog"><span class="toc-number">2.7.</span> <span class="toc-text">HyperLogLog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Geospatial"><span class="toc-number">2.8.</span> <span class="toc-text">Geospatial</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85"><span class="toc-number">3.</span> <span class="toc-text">å‘å¸ƒä¸è®¢é˜…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85"><span class="toc-number">3.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">è®¢é˜…æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">4.</span> <span class="toc-text">ä¹è§‚é”å’Œæ‚²è§‚é”</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Multi%E3%80%81Exec%E3%80%81discard"><span class="toc-number">4.1.</span> <span class="toc-text">Multiã€Execã€discard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">4.2.</span> <span class="toc-text">æ‚²è§‚é”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">4.3.</span> <span class="toc-text">ä¹è§‚é”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%B8%89%E7%89%B9%E6%80%A7"><span class="toc-number">4.4.</span> <span class="toc-text">Redisäº‹åŠ¡ä¸‰ç‰¹æ€§</span></a></li></ol></li></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By lijinhao</div><div class="framework-info"><span>Framework</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ»¡è…”æœŸå¾… å¸¸æ€€çƒ­æƒ… æœ‰äººç­‰ä½ <a target="_blank" rel="noopener" href="https://inews.gtimg.com/newsapp_ls/0/14146688226/0">Baikalâ™¥ï¸Swan</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">ç°¡</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="false"></script><script src="https://cdn-1.nesxc.com/js/smooth-scrolling.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script><script data-pjax>function GithubCalendarConfig(){var e=document.getElementById("recent-posts");e&&"/"==location.pathname&&(console.log("å·²æŒ‚è½½github calendar"),e.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>')),GithubCalendar("https://python-github-calendar-api.vercel.app/api?Leekinghou",["#ebedf0","#fdcdec","#fc9bd9","#fa6ac5","#f838b2","#f5089f","#c4067e","#92055e","#540336","#48022f","#30021f"],"Leekinghou")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:0}}</style><style></style></body></html>