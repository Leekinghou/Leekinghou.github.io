"use strict";function _typeof16(t){return(_typeof16="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _typeof15(t){return(_typeof15="function"==typeof Symbol&&"symbol"==_typeof16(Symbol.iterator)?function(t){return _typeof16(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof16(t)})(t)}function _typeof14(t){return(_typeof14="function"==typeof Symbol&&"symbol"==_typeof15(Symbol.iterator)?function(t){return _typeof15(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof15(t)})(t)}function _typeof13(t){return(_typeof13="function"==typeof Symbol&&"symbol"==_typeof14(Symbol.iterator)?function(t){return _typeof14(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof14(t)})(t)}function _typeof12(t){return(_typeof12="function"==typeof Symbol&&"symbol"==_typeof13(Symbol.iterator)?function(t){return _typeof13(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof13(t)})(t)}function _typeof11(t){return(_typeof11="function"==typeof Symbol&&"symbol"==_typeof12(Symbol.iterator)?function(t){return _typeof12(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof12(t)})(t)}function _typeof10(t){return(_typeof10="function"==typeof Symbol&&"symbol"==_typeof11(Symbol.iterator)?function(t){return _typeof11(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof11(t)})(t)}function _typeof9(t){return(_typeof9="function"==typeof Symbol&&"symbol"==_typeof10(Symbol.iterator)?function(t){return _typeof10(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof10(t)})(t)}function _typeof8(t){return(_typeof8="function"==typeof Symbol&&"symbol"==_typeof9(Symbol.iterator)?function(t){return _typeof9(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof9(t)})(t)}function _typeof7(t){return(_typeof7="function"==typeof Symbol&&"symbol"==_typeof8(Symbol.iterator)?function(t){return _typeof8(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof8(t)})(t)}function _typeof6(t){return(_typeof6="function"==typeof Symbol&&"symbol"==_typeof7(Symbol.iterator)?function(t){return _typeof7(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof7(t)})(t)}function _typeof5(t){return(_typeof5="function"==typeof Symbol&&"symbol"==_typeof6(Symbol.iterator)?function(t){return _typeof6(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof6(t)})(t)}function _typeof4(t){return(_typeof4="function"==typeof Symbol&&"symbol"==_typeof5(Symbol.iterator)?function(t){return _typeof5(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof5(t)})(t)}function _typeof3(t){return(_typeof3="function"==typeof Symbol&&"symbol"==_typeof4(Symbol.iterator)?function(t){return _typeof4(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof4(t)})(t)}function _typeof2(t){return(_typeof2="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(t){return _typeof3(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof3(t)})(t)}function asyncGeneratorStep(t,e,o,n,r,y,u){try{var c=t[y](u),f=c.value}catch(t){return void o(t)}c.done?e(f):Promise.resolve(f).then(n,r)}function _asyncToGenerator(c){return function(){var t=this,u=arguments;return new Promise(function(e,o){var n=c.apply(t,u);function r(t){asyncGeneratorStep(n,e,o,r,y,"next",t)}function y(t){asyncGeneratorStep(n,e,o,r,y,"throw",t)}r(void 0)})}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)})(t)}!function(){var o,t,e,n,p=window.crypto||window.msCrypto,a=window.localStorage,l="hexo-blog-encrypt:#"+window.location.pathname,s=S("hexo-blog-encrypt的作者们都是大帅比!"),m=S("hexo-blog-encrypt是地表最强Hexo加密插件!"),r=document.getElementById("hexo-blog-encrypt"),y=r.dataset.wpm,u=r.dataset.whm,c=r.getElementsByTagName("script").hbeData,f=c.innerText,i=c.dataset.hmacdigest;function b(t){return new Uint8Array(t.match(/[\da-f]{2}/gi).map(function(t){return parseInt(t,16)}))}function S(t){for(var e=t.length,o=0,n=new Array,r=0;r<e;){var y=t.codePointAt(r);y<128?(n[o++]=y,r++):127<y&&y<2048?(n[o++]=y>>6|192,n[o++]=63&y|128,r++):2047<y&&y<65536?(n[o++]=y>>12|224,n[o++]=y>>6&63|128,n[o++]=63&y|128,r++):(n[o++]=y>>18|240,n[o++]=y>>12&63|128,n[o++]=y>>6&63|128,n[o++]=63&y|128,r+=2)}return new Uint8Array(n)}function d(){return(d=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=document.createElement("script"),["type","text","src","crossorigin","defer","referrerpolicy"].forEach(function(t){e[t]&&(o[t]=e[t])}),t.abrupt("return",o);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function _(){return(_=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(o=document.createElement("div")).innerHTML=e,o.querySelectorAll("script").forEach(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,function(){return d.apply(this,arguments)}(e);case 3:t.t1=t.sent,t.t0.replaceWith.call(t.t0,t.t1);case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),t.abrupt("return",o);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function h(){return(h=_asyncToGenerator(regeneratorRuntime.mark(function t(e,o){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new TextEncoder,r=n.encode(o),n=b(i),t.next=5,p.subtle.verify({name:"HMAC",hash:"SHA-256"},e,n,r);case 5:return r=t.sent,console.log("Verification result: ".concat(r)),r||(alert(u),console.log("".concat(u,", got "),n," but proved wrong.")),t.abrupt("return",r);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}function g(){return w.apply(this,arguments)}function w(){return(w=_asyncToGenerator(regeneratorRuntime.mark(function t(e,o,c){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=b(f),t.next=3,p.subtle.decrypt({name:"AES-CBC",iv:o},e,n.buffer).then(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var o,n,r,y,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new TextDecoder,(o=r.decode(e)).startsWith("<hbe-prefix></hbe-prefix>")){t.next=4;break}throw"Decode successfully but not start with KnownPrefix.";case 4:return(n=document.createElement("button")).textContent="Encrypt again",n.type="button",n.classList.add("hbe-button"),n.addEventListener("click",function(){window.localStorage.removeItem(l),window.location.reload()}),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",t.t0=document.getElementById("hexo-blog-encrypt"),t.next=14,function(){return _.apply(this,arguments)}(o);case 14:if(t.t1=t.sent,t.t0.appendChild.call(t.t0,t.t1),document.getElementById("hexo-blog-encrypt").appendChild(n),document.querySelectorAll("img").forEach(function(t){t.getAttribute("data-src")&&!t.src&&(t.src=t.getAttribute("data-src"))}),window.NexT&&NexT.boot&&"function"==typeof NexT.boot.refresh&&NexT.boot.refresh(),(r=document.getElementById("toc-div"))&&(r.style.display="inline"),(y=document.getElementsByClassName("toc-div-class"))&&0<y.length)for(u=0;u<y.length;u++)y[u].style.display="inline";return t.next=25,function(){return h.apply(this,arguments)}(c,o);case 25:return t.abrupt("return",t.sent);case 26:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()).catch(function(t){return alert(y),console.log(t),!1});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}(e=JSON.parse(a.getItem(l)))&&(console.log("Password got from localStorage(".concat(l,"): "),e),o=b(e.iv).buffer,c=e.dk,t=e.hmk,p.subtle.importKey("jwk",c,{name:"AES-CBC",length:256},!0,["decrypt"]).then(function(e){p.subtle.importKey("jwk",t,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then(function(t){g(e,o,t).then(function(t){t||a.removeItem(l)})})})),r.addEventListener("keydown",(n=_asyncToGenerator(regeneratorRuntime.mark(function t(r){var y,u,c,f,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r.isComposing||13===r.keyCode)return y=document.getElementById("hbePass").value,t.next=4,o=y,n=void 0,n=new TextEncoder,p.subtle.importKey("raw",n.encode(o),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]);t.next=15;break;case 4:return u=t.sent,t.next=7,o=u,p.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:s.buffer,iterations:1024},o,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]);case 7:return c=t.sent,t.next=10,e=u,p.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:s.buffer,iterations:1024},e,{name:"AES-CBC",length:256},!0,["decrypt"]);case 10:return f=t.sent,t.next=13,e=u,p.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:m.buffer,iterations:512},e,128);case 13:i=t.sent,g(f,i,c).then(function(t){console.log("Decrypt result: ".concat(t)),t&&p.subtle.exportKey("jwk",f).then(function(e){p.subtle.exportKey("jwk",c).then(function(t){t={dk:e,iv:function(t){if("object"!==_typeof(t)||null===t||"number"!=typeof t.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var e,o=new Uint8Array(t),n="",r=0;r<o.length;r++)n+=1===(e=o[r].toString(16)).length?"0"+e:e;return n}(i),hmk:t},a.setItem(l,JSON.stringify(t))})})});case 15:case"end":return t.stop()}var e,o,n},t)})),function(t){return n.apply(this,arguments)}))}();