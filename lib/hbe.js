"use strict";function _typeof8(t){return(_typeof8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _typeof7(t){return(_typeof7="function"==typeof Symbol&&"symbol"==_typeof8(Symbol.iterator)?function(t){return _typeof8(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof8(t)})(t)}function _typeof6(t){return(_typeof6="function"==typeof Symbol&&"symbol"==_typeof7(Symbol.iterator)?function(t){return _typeof7(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof7(t)})(t)}function _typeof5(t){return(_typeof5="function"==typeof Symbol&&"symbol"==_typeof6(Symbol.iterator)?function(t){return _typeof6(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof6(t)})(t)}function _typeof4(t){return(_typeof4="function"==typeof Symbol&&"symbol"==_typeof5(Symbol.iterator)?function(t){return _typeof5(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof5(t)})(t)}function _typeof3(t){return(_typeof3="function"==typeof Symbol&&"symbol"==_typeof4(Symbol.iterator)?function(t){return _typeof4(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof4(t)})(t)}function _typeof2(t){return(_typeof2="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(t){return _typeof3(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof3(t)})(t)}function asyncGeneratorStep(t,e,n,r,o,c,u){try{var i=t[c](u),a=i.value}catch(t){return void n(t)}i.done?e(a):Promise.resolve(a).then(r,o)}function _asyncToGenerator(i){return function(){var t=this,u=arguments;return new Promise(function(e,n){var r=i.apply(t,u);function o(t){asyncGeneratorStep(r,e,n,o,c,"next",t)}function c(t){asyncGeneratorStep(r,e,n,o,c,"throw",t)}o(void 0)})}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)})(t)}!function(){var n,t,e,r,f=window.crypto||window.msCrypto,s=window.localStorage,p="hexo-blog-encrypt:#"+window.location.pathname,l=d("hexo-blog-encrypt的作者们都是大帅比!"),m=d("hexo-blog-encrypt是地表最强Hexo加密插件!"),o=document.getElementById("hexo-blog-encrypt"),c=o.dataset.wpm,u=o.dataset.whm,i=o.getElementsByTagName("script").hbeData,a=i.innerText,y=i.dataset.hmacdigest;function b(t){return new Uint8Array(t.match(/[\da-f]{2}/gi).map(function(t){return parseInt(t,16)}))}function d(t){for(var e=t.length,n=0,r=new Array,o=0;o<e;){var c=t.codePointAt(o);c<128?(r[n++]=c,o++):127<c&&c<2048?(r[n++]=c>>6|192,r[n++]=63&c|128,o++):2047<c&&c<65536?(r[n++]=c>>12|224,r[n++]=c>>6&63|128,r[n++]=63&c|128,o++):(r[n++]=c>>18|240,r[n++]=c>>12&63|128,r[n++]=c>>6&63|128,r[n++]=63&c|128,o+=2)}return new Uint8Array(r)}function h(){return(h=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=document.createElement("script"),["type","text","src","crossorigin","defer","referrerpolicy"].forEach(function(t){e[t]&&(n[t]=e[t])}),t.abrupt("return",n);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function g(){return(g=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(n=document.createElement("div")).innerHTML=e,n.querySelectorAll("script").forEach(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,function(){return h.apply(this,arguments)}(e);case 3:t.t1=t.sent,t.t0.replaceWith.call(t.t0,t.t1);case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),t.abrupt("return",n);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function S(){return(S=_asyncToGenerator(regeneratorRuntime.mark(function t(e,n){var r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new TextEncoder,o=r.encode(n),r=b(y),t.next=5,f.subtle.verify({name:"HMAC",hash:"SHA-256"},e,r,o);case 5:return o=t.sent,console.log("Verification result: ".concat(o)),o||(alert(u),console.log("".concat(u,", got "),r," but proved wrong.")),t.abrupt("return",o);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}function w(){return v.apply(this,arguments)}function v(){return(v=_asyncToGenerator(regeneratorRuntime.mark(function t(e,n,i){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=b(a),t.next=3,f.subtle.decrypt({name:"AES-CBC",iv:n},e,r.buffer).then(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n,r,o,c,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=new TextDecoder,(n=o.decode(e)).startsWith("<hbe-prefix></hbe-prefix>")){t.next=4;break}throw"Decode successfully but not start with KnownPrefix.";case 4:return(r=document.createElement("button")).textContent="Encrypt again",r.type="button",r.classList.add("hbe-button"),r.addEventListener("click",function(){window.localStorage.removeItem(p),window.location.reload()}),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",t.t0=document.getElementById("hexo-blog-encrypt"),t.next=14,function(){return g.apply(this,arguments)}(n);case 14:if(t.t1=t.sent,t.t0.appendChild.call(t.t0,t.t1),document.getElementById("hexo-blog-encrypt").appendChild(r),document.querySelectorAll("img").forEach(function(t){t.getAttribute("data-src")&&!t.src&&(t.src=t.getAttribute("data-src"))}),window.NexT&&NexT.boot&&"function"==typeof NexT.boot.refresh&&NexT.boot.refresh(),(o=document.getElementById("toc-div"))&&(o.style.display="inline"),(c=document.getElementsByClassName("toc-div-class"))&&0<c.length)for(u=0;u<c.length;u++)c[u].style.display="inline";return t.next=25,function(){return S.apply(this,arguments)}(i,n);case 25:return t.abrupt("return",t.sent);case 26:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()).catch(function(t){return alert(c),console.log(t),!1});case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}(e=JSON.parse(s.getItem(p)))&&(console.log("Password got from localStorage(".concat(p,"): "),e),n=b(e.iv).buffer,i=e.dk,t=e.hmk,f.subtle.importKey("jwk",i,{name:"AES-CBC",length:256},!0,["decrypt"]).then(function(e){f.subtle.importKey("jwk",t,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then(function(t){w(e,n,t).then(function(t){t||s.removeItem(p)})})})),o.addEventListener("keydown",(r=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var c,u,i,a,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o.isComposing||13===o.keyCode)return c=document.getElementById("hbePass").value,t.next=4,n=c,r=void 0,r=new TextEncoder,f.subtle.importKey("raw",r.encode(n),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]);t.next=15;break;case 4:return u=t.sent,t.next=7,n=u,f.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:l.buffer,iterations:1024},n,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]);case 7:return i=t.sent,t.next=10,e=u,f.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:l.buffer,iterations:1024},e,{name:"AES-CBC",length:256},!0,["decrypt"]);case 10:return a=t.sent,t.next=13,e=u,f.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:m.buffer,iterations:512},e,128);case 13:y=t.sent,w(a,y,i).then(function(t){console.log("Decrypt result: ".concat(t)),t&&f.subtle.exportKey("jwk",a).then(function(e){f.subtle.exportKey("jwk",i).then(function(t){t={dk:e,iv:function(t){if("object"!==_typeof(t)||null===t||"number"!=typeof t.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var e,n=new Uint8Array(t),r="",o=0;o<n.length;o++)r+=1===(e=n[o].toString(16)).length?"0"+e:e;return r}(y),hmk:t},s.setItem(p,JSON.stringify(t))})})});case 15:case"end":return t.stop()}var e,n,r},t)})),function(t){return r.apply(this,arguments)}))}();