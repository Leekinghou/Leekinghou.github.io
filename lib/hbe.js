"use strict";function _typeof6(e){return(_typeof6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof5(e){return(_typeof5="function"==typeof Symbol&&"symbol"==_typeof6(Symbol.iterator)?function(e){return _typeof6(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof6(e)})(e)}function _typeof4(e){return(_typeof4="function"==typeof Symbol&&"symbol"==_typeof5(Symbol.iterator)?function(e){return _typeof5(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof5(e)})(e)}function _typeof3(e){return(_typeof3="function"==typeof Symbol&&"symbol"==_typeof4(Symbol.iterator)?function(e){return _typeof4(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof4(e)})(e)}function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(e){return _typeof3(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof3(e)})(e)}function asyncGeneratorStep(e,t,n,r,o,c,u){try{var a=e[c](u),i=a.value}catch(e){return void n(e)}a.done?t(i):Promise.resolve(i).then(r,o)}function _asyncToGenerator(a){return function(){var e=this,u=arguments;return new Promise(function(t,n){var r=a.apply(e,u);function o(e){asyncGeneratorStep(r,t,n,o,c,"next",e)}function c(e){asyncGeneratorStep(r,t,n,o,c,"throw",e)}o(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}!function(){var n,e,t,r,y=window.crypto||window.msCrypto,f=window.localStorage,p="hexo-blog-encrypt:#"+window.location.pathname,l=d("hexo-blog-encrypt的作者们都是大帅比!"),m=d("hexo-blog-encrypt是地表最强Hexo加密插件!"),o=document.getElementById("hexo-blog-encrypt"),c=o.dataset.wpm,u=o.dataset.whm,a=o.getElementsByTagName("script").hbeData,i=a.innerText,s=a.dataset.hmacdigest;function b(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)}))}function d(e){for(var t=e.length,n=0,r=new Array,o=0;o<t;){var c=e.codePointAt(o);c<128?(r[n++]=c,o++):127<c&&c<2048?(r[n++]=c>>6|192,r[n++]=63&c|128,o++):2047<c&&c<65536?(r[n++]=c>>12|224,r[n++]=c>>6&63|128,r[n++]=63&c|128,o++):(r[n++]=c>>18|240,r[n++]=c>>12&63|128,r[n++]=c>>6&63|128,r[n++]=63&c|128,o+=2)}return new Uint8Array(r)}function h(){return(h=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.createElement("script"),["type","text","src","crossorigin","defer","referrerpolicy"].forEach(function(e){t[e]&&(n[e]=t[e])}),e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(){return(g=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("div")).innerHTML=t,n.querySelectorAll("script").forEach(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,function(){return h.apply(this,arguments)}(t);case 3:e.t1=e.sent,e.t0.replaceWith.call(e.t0,e.t1);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(){return(w=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,o=r.encode(n),r=b(s),e.next=5,y.subtle.verify({name:"HMAC",hash:"SHA-256"},t,r,o);case 5:return o=e.sent,console.log("Verification result: ".concat(o)),o||(alert(u),console.log("".concat(u,", got "),r," but proved wrong.")),e.abrupt("return",o);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,a){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=b(i),e.next=3,y.subtle.decrypt({name:"AES-CBC",iv:n},t,r.buffer).then(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,o,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new TextDecoder,(n=o.decode(t)).startsWith("<hbe-prefix></hbe-prefix>")){e.next=4;break}throw"Decode successfully but not start with KnownPrefix.";case 4:return(r=document.createElement("button")).textContent="Encrypt again",r.type="button",r.classList.add("hbe-button"),r.addEventListener("click",function(){window.localStorage.removeItem(p),window.location.reload()}),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",e.t0=document.getElementById("hexo-blog-encrypt"),e.next=14,function(){return g.apply(this,arguments)}(n);case 14:if(e.t1=e.sent,e.t0.appendChild.call(e.t0,e.t1),document.getElementById("hexo-blog-encrypt").appendChild(r),document.querySelectorAll("img").forEach(function(e){e.getAttribute("data-src")&&!e.src&&(e.src=e.getAttribute("data-src"))}),window.NexT&&NexT.boot&&"function"==typeof NexT.boot.refresh&&NexT.boot.refresh(),(o=document.getElementById("toc-div"))&&(o.style.display="inline"),(c=document.getElementsByClassName("toc-div-class"))&&0<c.length)for(u=0;u<c.length;u++)c[u].style.display="inline";return e.next=25,function(){return w.apply(this,arguments)}(a,n);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){return alert(c),console.log(e),!1});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}(t=JSON.parse(f.getItem(p)))&&(console.log("Password got from localStorage(".concat(p,"): "),t),n=b(t.iv).buffer,a=t.dk,e=t.hmk,y.subtle.importKey("jwk",a,{name:"AES-CBC",length:256},!0,["decrypt"]).then(function(t){y.subtle.importKey("jwk",e,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then(function(e){S(t,n,e).then(function(e){e||f.removeItem(p)})})})),o.addEventListener("keydown",(r=_asyncToGenerator(regeneratorRuntime.mark(function e(o){var c,u,a,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isComposing||13===o.keyCode)return c=document.getElementById("hbePass").value,e.next=4,n=c,r=void 0,r=new TextEncoder,y.subtle.importKey("raw",r.encode(n),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]);e.next=15;break;case 4:return u=e.sent,e.next=7,n=u,y.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:l.buffer,iterations:1024},n,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]);case 7:return a=e.sent,e.next=10,t=u,y.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:l.buffer,iterations:1024},t,{name:"AES-CBC",length:256},!0,["decrypt"]);case 10:return i=e.sent,e.next=13,t=u,y.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:m.buffer,iterations:512},t,128);case 13:s=e.sent,S(i,s,a).then(function(e){console.log("Decrypt result: ".concat(e)),e&&y.subtle.exportKey("jwk",i).then(function(t){y.subtle.exportKey("jwk",a).then(function(e){e={dk:t,iv:function(e){if("object"!==_typeof(e)||null===e||"number"!=typeof e.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var t,n=new Uint8Array(e),r="",o=0;o<n.length;o++)r+=1===(t=n[o].toString(16)).length?"0"+t:t;return r}(s),hmk:e},f.setItem(p,JSON.stringify(e))})})});case 15:case"end":return e.stop()}var t,n,r},e)})),function(e){return r.apply(this,arguments)}))}();